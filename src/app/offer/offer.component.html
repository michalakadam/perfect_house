<div class="component-container">
    <div class="misc-agent-container">
        <div class="card misc-container">
            <perfect-gallery
                *ngIf="isGalleryActive"
                [photoUrls]="computePhotoUrls()">
            </perfect-gallery>

            <perfect-map
                *ngIf="isMapActive"
                [lattitude]="offer.lattitude"
                [longitude]="offer.longitude">
            </perfect-map>

            <embed *ngIf="isVirtualVisitActive" type="text/html" [src]="offer.virtualVisitUrl | safe">
        </div>
        <div class="card agent-brief">
            <perfect-agent-brief *ngIf="agentsDao.getAgentById(offer.agentId) as agent"
                [agent]="agent"
                bigger
                contactInfoVisible
                vertical
                (click)="navigateToAgentPage(agent)">
            </perfect-agent-brief>
        </div>
    </div>
    <div class="buttons-container" *ngIf="areButtonsVisible">
        <button
            pButton pRipple
            type="button"
            label="Zdjęcia"
            class="p-button-rounded p-button-raised"
            [class.selected]="isGalleryActive"
            (click)="showGallery()">
        </button>
        <button
            *ngIf="isMapButtonVisible"
            pButton pRipple
            type="button"
            label="Mapa"
            class="p-button-rounded p-button-raised"
            [class.selected]="isMapActive"
            (click)="showMap()">
        </button>
        <button
            *ngIf="isVirtualVisitButtonVisible"
            pButton pRipple
            type="button" 
            label="Wirtualna wizyta"
            class="p-button-rounded p-button-raised"
            [class.selected]="isVirtualVisitActive"
            (click)="showVirtualVisit()">
        </button>
    </div>
    <div class="card basic-info-card">
        <div class="price" *ngIf="offer.price > -1">
            <span *ngIf="offer.price > 1">
                {{ offer.price | prettifyNumber:'zł' }}
            </span>
            <span class="client-price" *ngIf="offer.price === 1">
                Zaproponuj cenę!
            </span>
        </div>
        <perfect-offer-details [offer]="offer"></perfect-offer-details>
    </div>
    <div class="card description-details" *ngIf="!windowSizeDetector.isWindowSmallerThanMobile">
        <div class="description">
            {{ offer.description }}
        </div>
        <div class="details">
            <ng-container *ngTemplateOutlet="details"></ng-container>
        </div>
    </div>
    <div class="card description-details-responsive" *ngIf="windowSizeDetector.isWindowSmallerThanMobile">
        <p-tabView>
            <p-tabPanel header="Opis">
                {{ offer.description }}
            </p-tabPanel>
            <p-tabPanel header="Szczegóły">
                <ng-container *ngTemplateOutlet="details"></ng-container>
            </p-tabPanel>
        </p-tabView>
    </div>
</div>

<ng-template #details>
    <div *ngFor="let field of definedOfferFields">
        {{ field.displayName }}: {{ field.value }}
        <span class="unit" *ngIf="field.unit">{{ field.unit }}</span>
    </div>
</ng-template>
